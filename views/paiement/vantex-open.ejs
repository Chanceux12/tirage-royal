<!DOCTYPE html>    
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cr√©er un compte VANTEX</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/css/intlTelInput.css" />

<style>
/* TON CSS ORIGINAL - RIEN CHANG√â */
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Inter", sans-serif;
  background: linear-gradient(135deg, #11998e, #0575e6);
  padding: 0;
  min-height: 100vh;
}

.card-wrapper {
  max-width: 1100px;
  margin: 50px auto;
  background: #fff;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 8px 28px rgba(0,0,0,0.08);
  display: flex;
  flex-direction: column;
}

.card-img {
  width: 100%;
  height: 220px;
  background: url('/image/vantex.jpg') center/cover no-repeat;
  order: 2;
}

@media (min-width: 920px) {
  .card-wrapper {
    flex-direction: row;
  }
  .card-img {
    width: 40%;
    height: auto;
    order: 0;
  }
}

.card {
  width: 100%;
  padding: 40px;
  order: 1;
}

h1 {
  text-align: center;
  color: #0A9999;
  font-size: 2rem;
  margin-bottom: 10px;
  font-weight: 600;
}

.subtitle {
  text-align: center;
  margin-bottom: 32px;
  color: #555;
  font-size: 1rem;
}

.form-grid {
  display: grid;
  gap: 22px;
}

.grid-2 { grid-template-columns: 1fr; }
@media (min-width: 850px) {
  .grid-2 { grid-template-columns: 1fr 1fr; }
}

.field {
  position: relative;
}

.field input,
.field select {
  width: 100%;
  height: 50px;
  padding: 0 14px;
  border: 1.7px solid #dce3e8;
  border-radius: 10px;
  font-size: 1rem;
  background: #fff;
  transition: 0.2s;
}

.field input:focus,
.field select:focus {
  border-color: #0A9999;
  box-shadow: 0 0 0 3px rgba(10,153,153,0.18);
}

.field label {
  position: absolute;
  left: 14px;
  top: -10px;
  background: #fff;
  padding: 0 5px;
  font-size: 0.78rem;
  color: #0A9999;
  pointer-events: none;
}

.phone .iti { width: 100%; }
.phone input { padding-left: 90px !important; }

.field input[type=file] { padding-top: 11px; }

.btn {
  width: 100%;
  height: 52px;
  margin-top: 12px;
  background: #0A9999;
  color: #fff;
  border: none;
  border-radius: 10px;
  font-size: 1.08rem;
  cursor: pointer;
}
.btn:hover { background: #087a7a; }

/* PHONE BLACK TEXT */
.iti__selected-dial-code { color: #000 !important; }
.iti__country-name,
.iti__dial-code,
.iti__selected-flag .iti__country-name,
.iti__selected-flag .iti__dial-code { color: #000 !important; }

/* SECTION DE VERIFICATION */
#verifyBox {
  display: none;
  margin-top: 30px;
  padding: 20px;
  border: 2px solid #0A9999;
  border-radius: 12px;
  background: #f7fdfd;
}
#verifyBox h2 {
  text-align: center;
  color: #0A9999;
  margin-bottom: 20px;
}
.verify-line {
  margin: 8px 0;
  font-size: 1rem;
}

/* üîç Lisibilit√© section V√©rification */
#verifyBox,
#verifyBox h2,
#verifyBox .verify-line,
#verifyBox strong,
#verifyBox span,
#verifyBox label {
  color: #000 !important;
}

/* Texte CGU bien lisible */
#verifyBox input[type="checkbox"] + span {
  color: #000 !important;
}

/* Aper√ßu documents */
#previewFront, #previewBack {
  margin-top: 5px;
  font-style: italic;
  font-size: 0.9rem;
  color: #333;
}

/* SECTION CODE */
#codeBox {
  display: none;
  margin-top: 30px;
  padding: 20px;
  border: 2px solid #0A9999;
  border-radius: 12px;
  background: #f0fdfd;
  text-align: center;
}
#codeBox input {
  width: 120px;
  font-size: 1.2rem;
  text-align: center;
  margin: 10px 0;
}
#timer {
  font-weight: bold;
  color: #0A9999;
}
#codeError {
  color: red;
  margin-top: 10px;
}
#resendBtn, #changeEmailBtn {
  margin-top: 10px;
  margin-right: 5px;
}
</style>
</head>

<body>

<div class="card-wrapper">

  <div class="card">
    <h1>Cr√©er un compte VANTEX</h1>
    <p class="subtitle">Rejoignez VANTEX et profitez d‚Äôune exp√©rience financi√®re simple, rapide et s√©curis√©e.</p>

    <!-- FORMULAIRE -->
    <form id="vantexForm" method="POST" action="/paiement/vantex/submit" enctype="multipart/form-data">
      <div class="form-grid grid-2">

        <div class="field">
          <select name="civility" required>
            <option value="" disabled selected></option>
            <option value="M.">M.</option>
            <option value="Mme">Mme</option>
            <option value="Mlle">Mlle</option>
            <option value="Dr">Dr</option>
            <option value="Pr">Pr</option>
            <option value="Me">Me</option>
            <option value="Pr.">Pr.</option>
            <option value="Ing.">Ing.</option>
          </select>
          <label>Civilit√©</label>
        </div>

        <div class="field">
          <input type="text" name="firstname" placeholder=" " required />
          <label>Pr√©nom</label>
        </div>

        <div class="field" style="grid-column:1/-1;">
          <input type="text" name="lastname" placeholder=" " required />
          <label>Nom</label>
        </div>

        <div class="field">
          <input type="email" name="email" placeholder=" " required />
          <label>Email</label>
        </div>

        <div class="field phone">
          <label style="top:-10px;">T√©l√©phone</label>
          <input type="tel" id="phone" name="phone" required />
        </div>

        <div class="field" style="grid-column:1/-1;">
          <input type="text" name="profession" placeholder=" " required />
          <label>Profession</label>
        </div>

        <div class="field">
          <select id="country" name="country" required>
            <option value="" selected disabled></option>
          </select>
          <label>Pays</label>
        </div>

        <div class="field">
          <input type="text" name="region" placeholder=" " required />
          <label>R√©gion / Province</label>
        </div>

        <div class="field" style="grid-column:1/-1;">
          <input type="text" name="street" placeholder=" " required />
          <label>Rue</label>
        </div>

        <div class="field">
          <input type="text" name="city" placeholder=" " required />
          <label>Ville</label>
        </div>

        <div class="field">
          <input type="text" name="zip" placeholder=" " required />
          <label>Code postal</label>
        </div>

        <div class="field file" style="grid-column:1/-1;">
          <input type="file" name="id_front" accept=".jpg,.png,.jpeg,.pdf" required />
          <label>Document d'identit√© ‚Äî recto</label>
          <div id="previewFront"></div>
        </div>

        <div class="field file" style="grid-column:1/-1;">
          <input type="file" name="id_back" accept=".jpg,.png,.jpeg,.pdf" required />
          <label>Document d'identit√© ‚Äî verso</label>
          <div id="previewBack"></div>
        </div>

        <div class="field" style="grid-column:1/-1;">
          <label>Signature <span id="sigError" style="color:red; display:none;">(Signature obligatoire)</span></label>
          <div id="sigMobileMsg" style="font-size:0.85rem; color:#555; margin-bottom:5px; display:none;">Touchez le canvas pour signer</div>
          <canvas id="signaturePad" width="300" height="100" style="border:1px solid #ccc; border-radius:8px;"></canvas>
          <button type="button" id="clearSig" style="margin-top:5px;">Effacer</button>
          <input type="hidden" name="signature" id="signatureInput" required />
        </div>

      </div>

      <button type="button" id="verifyBtn" class="btn">V√©rifier mes informations</button>
    </form>

    <!-- SECTION VERIFICATION -->
    <div id="verifyBox">
      <h2>V√©rifiez vos informations</h2>

      <div id="verifyContent"></div>

      <label style="display:flex; align-items:center; gap:10px; margin-top:15px;">
        <input type="checkbox" id="cgu" required>  
        <span>J'accepte les conditions g√©n√©rales</span>
      </label>

      <button class="btn" id="editBtn">Modifier</button>
      <button class="btn" id="submitFinalBtn" style="margin-top:10px; background:#0a7;">Soumettre ma demande</button>
    </div>

    <!-- SECTION CODE -->
    <div id="codeBox">
      <h2>Confirmez votre e-mail</h2>
      <p>Un code √† 6 chiffres a √©t√© envoy√© √† votre e-mail. Entrez-le ci-dessous :</p>
      <input type="text" id="emailCode" maxlength="6" placeholder="000000" />
      <div id="timer">02:00</div>
      <div id="codeError"></div>
      <button class="btn" id="resendBtn">Renvoyer le code</button>
      <button class="btn" id="changeEmailBtn">Modifier l‚Äôe-mail</button>
    </div>

  </div>

  <div class="card-img"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/intlTelInput.min.js"></script>

<script>
/* --- CODE COMPLET JS --- */
/* TEL */
const phone = document.querySelector("#phone");
window.intlTelInput(phone, {
  separateDialCode: true,
  initialCountry: "fr",
  preferredCountries: ["fr","be","ca","ch"],
  utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/utils.js"
});

/* CHARGER LES PAYS */
async function loadCountries() {
  const res = await fetch("/json/countries.json");
  const data = await res.json();
  const sel = document.getElementById("country");
  data.sort((a,b)=> a.name.common.localeCompare(b.name.common));
  data.forEach(c=>{
    const opt=document.createElement("option");
    opt.value=c.name.common;
    opt.textContent=c.name.common;
    sel.appendChild(opt);
  });
}
loadCountries();

/* APER√áU DOCUMENTS */
const idFrontInput = document.querySelector('input[name="id_front"]');
const idBackInput = document.querySelector('input[name="id_back"]');
idFrontInput.onchange = (e) => { document.getElementById("previewFront").textContent = e.target.files[0]?.name || ''; };
idBackInput.onchange = (e) => { document.getElementById("previewBack").textContent = e.target.files[0]?.name || ''; };

/* SIGNATURE */
const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
const sigMobileMsg = document.getElementById("sigMobileMsg");
if (isMobile) sigMobileMsg.style.display = "block";

const canvas = document.getElementById('signaturePad');
const ctx = canvas.getContext('2d');
let drawing = false;
let isSigned = false;
canvas.addEventListener('mousedown', e => { drawing = true; });
canvas.addEventListener('mouseup', e => { drawing = false; ctx.beginPath(); });
canvas.addEventListener('mouseleave', e => { drawing = false; ctx.beginPath(); });
canvas.addEventListener('mousemove', draw);
canvas.addEventListener('touchstart', e => { e.preventDefault(); drawing = true; hideMobileMsg(); });
canvas.addEventListener('touchend', e => { e.preventDefault(); drawing = false; ctx.beginPath(); });
canvas.addEventListener('touchcancel', e => { e.preventDefault(); drawing = false; ctx.beginPath(); });
canvas.addEventListener('touchmove', drawTouch, { passive: false });
function hideMobileMsg() { if (sigMobileMsg.style.display !== "none") sigMobileMsg.style.display = "none"; }
function draw(e){ if(!drawing)return; ctx.lineWidth=2; ctx.lineCap="round"; ctx.strokeStyle="#000"; ctx.lineTo(e.offsetX,e.offsetY); ctx.stroke(); ctx.beginPath(); ctx.moveTo(e.offsetX,e.offsetY); isSigned=true; hideMobileMsg();}
function drawTouch(e){ if(!drawing)return; const rect=canvas.getBoundingClientRect(); const touch=e.touches[0]; const x=touch.clientX-rect.left; const y=touch.clientY-rect.top; ctx.lineWidth=2; ctx.lineCap="round"; ctx.strokeStyle="#000"; ctx.lineTo(x,y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(x,y); isSigned=true; hideMobileMsg();}
document.getElementById("clearSig").onclick = () => { ctx.clearRect(0,0,canvas.width,canvas.height); isSigned=false; if(isMobile)sigMobileMsg.style.display="block"; };

/* V√âRIFICATION FORMULAIRE */
const labelsFR = { civility:"Civilit√©", firstname:"Pr√©nom", lastname:"Nom", email:"Adresse e-mail", phone:"T√©l√©phone", profession:"Profession", country:"Pays", region:"R√©gion / Province", street:"Rue", city:"Ville", zip:"Code postal" };
document.getElementById("verifyBtn").onclick = () => {
  const form = document.getElementById("vantexForm");
  let valid = true;
  form.querySelectorAll("input, select").forEach(el=>{ if(!el.checkValidity()){el.style.borderColor="red"; valid=false;} else{el.style.borderColor="#dce3e8";}});
  if(!isSigned){document.getElementById("sigError").style.display="inline"; valid=false;} else{document.getElementById("sigError").style.display="none";}
  if(!valid){alert("Veuillez remplir tous les champs obligatoires et signer."); return;}
  const box = document.getElementById("verifyBox");
  const content = document.getElementById("verifyContent");
  const formData = new FormData(form);
  let html="";
  formData.forEach((val,key)=>{ if(key==="id_front"||key==="id_back"||key==="signature")return; if(!labelsFR[key])return; html+=`<div class="verify-line"><strong>${labelsFR[key]} :</strong> ${val}</div>`;});
  if(idFrontInput.files[0]) html+=`<div class="verify-line"><strong>Document recto :</strong> ${idFrontInput.files[0].name}</div>`;
  if(idBackInput.files[0]) html+=`<div class="verify-line"><strong>Document verso :</strong> ${idBackInput.files[0].name}</div>`;
  html+=`<div class="verify-line"><strong>Signature :</strong> <em>Sign√©e</em></div>`;
  content.innerHTML = html;
  form.style.display="none"; box.style.display="block";
};

/* MODIFIER */
document.getElementById("editBtn").onclick = () => {
  document.getElementById("verifyBox").style.display="none";
  document.getElementById("vantexForm").style.display="block";
  document.getElementById("codeBox").style.display="none";
};

/* CODE E-MAIL */
let countdown;
function startTimer(seconds){
  clearInterval(countdown);
  let remaining = seconds;
  const timerEl = document.getElementById("timer");
  countdown = setInterval(()=>{
    const m = String(Math.floor(remaining/60)).padStart(2,'0');
    const s = String(remaining%60).padStart(2,'0');
    timerEl.textContent = `${m}:${s}`;
    remaining--;
    if(remaining<0){clearInterval(countdown); document.getElementById("codeError").textContent="Le code a expir√©.";}
  },1000);
}

/* SUBMIT FINAL DANS CODEBOX */
document.getElementById("submitFinalBtn").onclick = async () => {
  if(!isSigned){alert("Veuillez signer avant de soumettre."); return;}
  if(!document.getElementById("cgu").checked){alert("Veuillez accepter les conditions g√©n√©rales."); return;}
  document.getElementById("signatureInput").value=canvas.toDataURL();
  // Cacher verifyBox, montrer codeBox
  document.getElementById("verifyBox").style.display="none";
  document.getElementById("codeBox").style.display="block";
  const email=document.vantexForm.email.value;
  const res=await fetch("/vantex/send-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email})});
  const data=await res.json();
  if(data.success){startTimer(120); document.getElementById("codeError").textContent="Code envoy√© √† votre e-mail.";}
  else{document.getElementById("codeError").textContent="Impossible d'envoyer le code, v√©rifiez l‚Äôe-mail."; document.getElementById("codeBox").style.display="none"; document.getElementById("verifyBox").style.display="block";}
};

/* VALIDATION CODE */
document.getElementById("emailCode").addEventListener("keypress", async (e)=>{
  if(e.key==="Enter"){
    e.preventDefault();
    const code=document.getElementById("emailCode").value;
    const res=await fetch("/vantex/verify-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:document.vantexForm.email.value,code})});
    const data=await res.json();
    if(data.success){document.getElementById("vantexForm").submit();}
    else{document.getElementById("codeError").textContent="Code incorrect ou expir√©.";}
  }
});

/* RENVOYER CODE */
document.getElementById("resendBtn").onclick = async ()=>{
  const email=document.vantexForm.email.value;
  const res=await fetch("/vantex/send-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email})});
  const data=await res.json();
  if(data.success){startTimer(120); document.getElementById("codeError").textContent="Code renvoy√©.";}
  else{document.getElementById("codeError").textContent="Impossible de renvoyer le code.";}
};

/* MODIFIER EMAIL */
document.getElementById("changeEmailBtn").onclick = ()=>{
  document.getElementById("verifyBox").style.display="none";
  document.getElementById("codeBox").style.display="none";
  document.getElementById("vantexForm").style.display="block";
};
</script>

</body>
</html>




