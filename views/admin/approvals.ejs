<!DOCTYPE html>  
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gestion des utilisateurs - Admin</title>
  <link rel="stylesheet" href="/styles/style.css">
</head>
<body>
  <div class="container py-5">
    <h1 class="mb-4 text-center">Gestion des comptes utilisateurs</h1>

    <% if (success && success.length > 0) { %>
      <div class="alert alert-success text-center"><%= success %></div>
    <% } %>
    <% if (error && error.length > 0) { %>
      <div class="alert alert-danger text-center"><%= error %></div>
    <% } %>

    <% if (!users || users.length === 0) { %>
      <div class="alert alert-info text-center">
        Aucun utilisateur √† afficher.
      </div>
    <% } else { %>
      <div class="table-responsive">
        <table class="table table-bordered align-middle table-hover">
          <thead class="table-dark text-center">
            <tr>
              <th>Nom</th>
              <th>Email</th>
              <th>Pi√®ce d'identit√©</th> <!-- ‚úÖ colonne ajout√©e -->
              <th>Statut</th>
              <th>Solde (‚Ç¨)</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% users.forEach(user => { %>
              <tr>
                <td><%= user.prenom %> <%= user.nom %> (<%= user.username %>)</td>
                <td><%= user.email %></td>

                <!-- ‚úÖ Colonne pi√®ce d‚Äôidentit√© -->
                <td class="text-center">
                  <% if (user.pieceIdentite) { %>
                    <a href="/uploads/piecesIdentite/<%= user.pieceIdentite %>" target="_blank">
                      <img src="/uploads/piecesIdentite/<%= user.pieceIdentite %>" 
                           alt="Pi√®ce d'identit√©" 
                           style="width: 80px; height: auto; border-radius: 5px; border: 1px solid #ccc;">
                    </a>
                  <% } else { %>
                    ‚ùå Non fournie
                  <% } %>
                </td>

                <!-- ‚úÖ Statut -->
                <td class="text-center">
                  <% if (user.isApproved) { %>
                    ‚úÖ Approuv√©
                  <% } else { %>
                    ‚è≥ En attente
                  <% } %>
                </td>

                <!-- ‚úÖ Solde -->
                <td class="text-end"><%= user.solde.toFixed(2) %> ‚Ç¨</td>

                <!-- ‚úÖ Actions -->
                <td>
                  <div class="d-flex gap-2">
                    <% if (!user.isApproved) { %>
                      <form action="/admin/approve/<%= user._id %>" method="POST" onsubmit="return confirm('Approuver <%= user.username %> ?')">
                        <button class="btn btn-success btn-sm">‚úÖ Approuver</button>
                      </form>
                    <% } %>

                    <form action="/admin/crediter/<%= user._id %>" method="POST" class="d-flex" style="gap: 5px;">
                      <input type="number" name="montant" step="0.01" min="0" class="form-control form-control-sm" placeholder="‚Ç¨" required>
                      <button class="btn btn-primary btn-sm">üí≥ Cr√©diter</button>
                    </form>
                  </div>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
